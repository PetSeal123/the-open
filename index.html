<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Golf Game Leaderboard</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 2rem; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
    h2 { margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>The Open ‚Äì Friends Game Leaderboard</h1>

  <h2>üèÜ Game Standings</h2>
  <div id="game-leaderboard"></div>

  <h2>üìã Player Picks</h2>
  <div id="friend-picks"></div>

  <script>
    const apiKey = 'a35ccc1e4bad48b294234c217fb80bde';
    const tournamentId = '642'; // Update if needed

    // Update with real golfer names from API
    const friendPicks = {
      "Sticky": ["Rory McIlroy", "Shane Lowry", "Tommy Fleetwood"],
      "Moz": ["Scottie Scheffler", "Tommy Fleetwood", "Robert MacIntyre"],
      "Parks": ["Scottie Scheffler", "Collin Morikawa", "Ludvig Aberg"],
      "Pet Seal": ["Scottie Scheffler", "Marco Penge", "Xander Schauffele"],
      "Gabin": ["Tommy Fleetwood", "Viktor Hovland", "Tyrrell Hatton"],
      "Stoney": ["Jon Rahm", "Tommy Fleetwood", "Adam Scott"],
      "AliMac": ["Scottie Scheffler", "Rory McIlroy", "Jon Rahm"]
    };

    async function fetchLeaderboard() {
      const url = `https://api.sportsdata.io/golf/v2/json/Leaderboard/${tournamentId}?key=${apiKey}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const players = data.Players || [];

        renderGameLeaderboard(players);
      } catch (err) {
        console.error('Failed to fetch leaderboard:', err);
      }
    }

    function renderGameLeaderboard(players) {
      const gameResults = [];

      for (const [friend, picks] of Object.entries(friendPicks)) {
        const pickDetails = picks.map(name => {
          const player = players.find(p => p.Name === name);
          return {
            name,
            rank: player ? parseInt(player.Rank) : 999 // fallback for missing
          };
        });

        const totalScore = pickDetails.reduce((sum, p) => sum + p.rank, 0);

        gameResults.push({
          friend,
          totalScore,
          picks: pickDetails
        });
      }

      // Sort friends by total rank (lowest wins)
      gameResults.sort((a, b) => a.totalScore - b.totalScore);

      // Build Game Leaderboard Table
      const gameTable = `
        <table>
          <thead><tr><th>Friend</th><th>Total Rank</th></tr></thead>
          <tbody>
            ${gameResults.map(r => `
              <tr>
                <td>${r.friend}</td>
                <td>${r.totalScore}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      document.getElementById('game-leaderboard').innerHTML = gameTable;

      // Build Friend Picks Table
      const picksHTML = gameResults.map(r => `
        <h3>${r.friend}</h3>
        <table>
          <thead><tr><th>Golfer</th><th>Rank</th></tr></thead>
          <tbody>
            ${r.picks.map(p => `
              <tr>
                <td>${p.name}</td>
                <td>${p.rank !== 999 ? p.rank : 'N/A'}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `).join('');
      document.getElementById('friend-picks').innerHTML = picksHTML;
    }

    fetchLeaderboard();
    setInterval(fetchLeaderboard, 60 * 1000); // refresh every 1 minute
  </script>
</body>
</html>
